<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TENNIS CD9 2026</title>
    <style>
        :root {
            --primary: #1b5e20;
            --accent: #ffff00;
            --dark: #121212;
            --gray: #f5f5f5;
        }

        body {
            margin: 0;
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #eee;
            color: #333;
            line-height: 1.5;
        }

        header {
            background: var(--dark);
            color: var(--accent);
            text-align: center;
            padding: 15px 0;
            font-size: 20px;
            font-weight: 900;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-bottom: 3px solid var(--primary);
        }

        /* Menu tối ưu cho mobile */
        nav {
            display: flex;
            background: #222;
            sticky;
            top: 0;
            z-index: 1000;
            overflow-x: auto;
            scrollbar-width: none;
        }
        nav::-webkit-scrollbar { display: none; }

        nav button {
            flex: 1;
            min-width: 75px;
            padding: 12px 5px;
            background: none;
            color: #aaa;
            border: none;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
        }

        nav button.active {
            color: #fff;
            background: var(--primary);
            border-bottom: 3px solid var(--accent);
        }

        section { display: none; padding: 10px; }
        section.active { display: block; }

        /* Container bảng để cuộn ngang trên mobile */
        .table-wrapper {
            background: white;
            border-radius: 4px;
            overflow-x: auto;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* Ép cố định tỷ lệ cột */
            min-width: 450px; /* Đảm bảo không quá nhỏ trên mobile */
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px 4px;
            text-align: center;
            font-size: 13px;
            word-wrap: break-word;
        }

        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #444;
            font-size: 11px;
            text-transform: uppercase;
        }

        /* Định dạng riêng cho trang MATCHES để cân đối */
        #MATCHES-table th:nth-child(1), #MATCHES-table td:nth-child(1) { width: 35px; } /* Ngày */
        #MATCHES-table th:nth-child(2), #MATCHES-table td:nth-child(2) { width: 35px; } /* Tháng */
        #MATCHES-table th:nth-child(3), #MATCHES-table td:nth-child(3) { width: 50px; } /* Năm */
        #MATCHES-table th:nth-child(4), #MATCHES-table td:nth-child(4) { width: 35%; text-align: left; padding-left: 8px; } /* Team 1 */
        #MATCHES-table th:nth-child(5), #MATCHES-table td:nth-child(5) { width: 40px; background: #fffde7; font-weight: bold; } /* Tỷ số 1 */
        #MATCHES-table th:nth-child(6), #MATCHES-table td:nth-child(6) { width: 40px; background: #fffde7; font-weight: bold; } /* Tỷ số 2 */
        #MATCHES-table th:nth-child(7), #MATCHES-table td:nth-child(7) { width: 35%; text-align: left; padding-left: 8px; } /* Team 2 */

        .score { color: #d32f2f; font-size: 15px; }
        .player-name { font-weight: 500; color: #1a237e; }

        /* Hiệu ứng loading */
        .loading { text-align: center; padding: 50px; color: #666; font-style: italic; }

        @media (max-width: 480px) {
            th, td { font-size: 11px; padding: 6px 2px; }
            header { font-size: 16px; }
        }
    </style>
</head>
<body>

<header>TENNIS CD9 2026</header>

<nav>
    <button onclick="showTab(event, 'BXH')" class="active">BXH</button>
    <button onclick="showTab(event, 'MATCHES')">MATCHES</button>
    <button onclick="showTab(event, 'TEAMS')">TEAMS</button>
    <button onclick="showTab(event, 'PAIRS')">PAIRS</button>
    <button onclick="showTab(event, 'CHECK')">CHECK</button>
</nav>

<div id="content">
    <section id="BXH" class="active"><div class="loading">Đang tải...</div></section>
    <section id="MATCHES"><div class="loading">Đang tải...</div></section>
    <section id="TEAMS"><div class="loading">Đang tải...</div></section>
    <section id="PAIRS"><div class="loading">Đang tải...</div></section>
    <section id="CHECK"><div class="loading">Đang tải...</div></section>
</div>

<script>
const SHEET_ID = "1pak2Yy4rZ3U50rYj2rlfCOkqyDDpnOns";

function showTab(e, id) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    e.currentTarget.classList.add('active');
}

async function loadSheet(sheetName, targetId) {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
    
    try {
        const r = await fetch(url);
        const txt = await r.text();
        const json = JSON.parse(txt.substring(47).slice(0, -2));
        const rows = json.table.rows;
        const cols = json.table.cols;

        let html = `<div class="table-wrapper"><table id="${targetId}-table"><thead><tr>`;
        
        // Header xử lý thông minh: lấy label hoặc lấy mặc định nếu trống
        for(let i=0; i < cols.length; i++) {
            let label = cols[i].label ? cols[i].label : "";
            html += `<th>${label}</th>`;
        }
        html += `</tr></thead><tbody>`;

        rows.forEach(row => {
            // Bỏ qua dòng nếu tất cả các ô đều trống
            if (!row.c.some(cell => cell && cell.v !== null)) return;

            html += `<tr>`;
            for(let i=0; i < cols.length; i++) {
                let cell = row.c[i];
                let val = "";
                if (cell) {
                    val = cell.f ? cell.f : (cell.v !== null ? cell.v : "");
                }

                // Thêm class đặc biệt cho trang MATCHES để format đẹp
                let className = "";
                if (targetId === "MATCHES") {
                    if (i === 4 || i === 5) className = "score";
                    if (i === 3 || i === 6) className = "player-name";
                }
                
                html += `<td class="${className}">${val}</td>`;
            }
            html += `</tr>`;
        });

        html += `</tbody></table></div>`;
        document.getElementById(targetId).innerHTML = html;
    } catch (err) {
        document.getElementById(targetId).innerHTML = "Lỗi tải dữ liệu. Hãy kiểm tra kết nối.";
    }
}

// Chạy tải dữ liệu khi mở trang
window.addEventListener('DOMContentLoaded', () => {
    loadSheet("BXH", "BXH");
    loadSheet("MATCHES", "MATCHES");
    loadSheet("TEAMS", "TEAMS");
    loadSheet("PAIRS", "PAIRS");
    loadSheet("CHECK", "CHECK");
});
</script>

</body>
</html>
