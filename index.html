<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TENNIS CD9 2026</title>
    <style>
        :root {
            --primary: #1b5e20;
            --primary-light: #4caf50;
            --accent: #ffff00;
            --dark: #121212;
            --bg: #f0f2f5; /* N·ªÅn x√°m nh·∫°t */
            --text-dark: #333;
            --win-color: #2e7d32; /* Xanh l√° ƒë·∫≠m */
            --lose-color: #c62828; /* ƒê·ªè ƒë·∫≠m */
            --draw-color: #757575; /* X√°m */
            --shadow-light: 0 2px 5px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 10px rgba(0,0,0,0.15);
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg);
            color: var(--text-dark);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        header {
            background: var(--dark);
            color: var(--accent);
            text-align: center;
            padding: 20px 0;
            font-size: 24px;
            font-weight: 900;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-bottom: 4px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 2000;
            box-shadow: var(--shadow-medium);
        }

        .section-title {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 12px 15px;
            margin-top: 25px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 17px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            top: 72px; /* D∆∞·ªõi header */
            z-index: 1000;
            box-shadow: var(--shadow-light);
            border-radius: 8px 8px 0 0;
            gap: 8px; /* Kho·∫£ng c√°ch icon v√† ch·ªØ */
        }
        .section-title:first-of-type { border-radius: 0; } /* Header ƒë·∫ßu ti√™n kh√¥ng bo g√≥c tr√™n */


        .container {
            padding: 10px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- Table styles (for BXH, TEAMS, PAIRS, CHECK tab table) --- */
        .table-wrapper {
            background: white;
            margin-bottom: 15px;
            border-radius: 0 0 8px 8px;
            overflow-x: auto;
            box-shadow: var(--shadow-light);
            border-top: 1px solid #eee; /* ƒê∆∞·ªùng k·∫ª d∆∞·ªõi ti√™u ƒë·ªÅ section */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* T·ª± ƒë·ªông co gi√£n theo n·ªôi dung */
            min-width: 400px; /* ƒê·∫£m b·∫£o kh√¥ng qu√° nh·ªè */
        }

        th, td {
            border: 1px solid #e0e0e0;
            padding: 10px 8px;
            text-align: center;
            vertical-align: middle;
            font-size: 13px;
            word-wrap: break-word; /* T·ª± xu·ªëng d√≤ng */
        }

        th {
            background: #e9ecef;
            color: #495057;
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        tr:nth-child(even) { background-color: #f8f9fa; } /* Zeebra-striping */
        tr:hover { background-color: #e6f7ff; cursor: pointer; }


        /* --- Card Layout for MATCHES & CHECK_RESULT --- */
        .card-list {
            padding: 10px 0; /* Kho·∫£ng c√°ch tr√™n d∆∞·ªõi cho list */
            background: white;
            border-radius: 0 0 8px 8px;
            box-shadow: var(--shadow-light);
            border-top: 1px solid #eee;
        }

        .match-card {
            background: #fff;
            border-radius: 12px;
            padding: 15px;
            margin: 0 10px 10px 10px; /* Kho·∫£ng c√°ch gi·ªØa c√°c card */
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border-left: 5px solid #ccc; /* Border tr√°i ƒë·ªÉ hi·ªán tr·∫°ng th√°i */
            transition: transform 0.2s ease-in-out;
            min-height: 70px; /* ƒê·∫£m b·∫£o chi·ªÅu cao t·ªëi thi·ªÉu */
        }
        .match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.12);
        }

        .match-card.win { border-left-color: var(--win-color); }
        .match-card.lose { border-left-color: var(--lose-color); }
        .match-card.draw { border-left-color: var(--draw-color); }
        .match-card.pending { border-left-color: #ffc107; } /* M√†u v√†ng cho tr·∫≠n ch∆∞a ƒë·∫•u */


        .match-date {
            font-size: 11px;
            color: #777;
            text-align: center;
            margin-bottom: 5px;
            flex-basis: 100%; /* Chi·∫øm to√†n b·ªô chi·ªÅu ngang tr√™n mobile */
        }

        .team-display {
            flex: 1; /* Chi·∫øm kh√¥ng gian c√≤n l·∫°i */
            display: flex;
            flex-direction: column;
            align-items: center; /* CƒÉn gi·ªØa */
            text-align: center;
        }
        .team-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-dark);
            line-height: 1.2;
        }
        .team-name.highlight {
            color: var(--primary); /* M√†u n·ªïi b·∫≠t cho ƒë·ªôi ƒëang l·ªçc */
        }

        .score-display {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            flex-shrink: 0; /* Kh√¥ng co l·∫°i */
        }
        .score-box {
            background: var(--dark);
            color: var(--accent);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 900;
            line-height: 1;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        .score-separator {
            font-size: 18px;
            font-weight: 900;
            color: #666;
            margin: 0 5px;
        }

        /* --- Filter buttons for CHECK --- */
        .filter-container {
            display: flex;
            flex-wrap: wrap; /* Cho ph√©p xu·ªëng d√≤ng tr√™n mobile */
            gap: 8px;
            justify-content: center;
            padding: 15px 10px;
            background: #fff;
            border-bottom: 1px solid #eee;
            border-radius: 0 0 8px 8px;
            box-shadow: var(--shadow-light);
            margin-top: 0; /* ƒê√≠nh v√†o section title */
        }
        .filter-btn {
            padding: 8px 18px;
            border: 2px solid var(--primary);
            background: #fff;
            color: var(--primary);
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-size: 13px;
            text-transform: uppercase;
        }
        .filter-btn:hover:not(.active) {
            background: var(--primary-light);
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .filter-btn.active {
            background: var(--primary);
            color: #fff;
            box-shadow: var(--shadow-light);
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-style: italic;
            color: #888;
            background: white;
            border-radius: 0 0 8px 8px;
            box-shadow: var(--shadow-light);
        }
        .empty-message {
            text-align: center;
            padding: 20px;
            color: #555;
            background: white;
            border-radius: 0 0 8px 8px;
            box-shadow: var(--shadow-light);
        }

        /* Responsive adjustments */
        @media (max-width: 576px) {
            header { font-size: 20px; padding: 15px 0; }
            .section-title { font-size: 15px; top: 60px; padding: 10px; }
            th, td { font-size: 11px; padding: 8px 4px; }
            .filter-btn { padding: 6px 12px; font-size: 11px; }
            .match-card { flex-wrap: wrap; justify-content: center; text-align: center; padding: 12px; }
            .match-date { flex-basis: 100%; order: -1; margin-bottom: 10px; } /* Ng√†y l√™n tr√™n c√πng */
            .team-display { flex-basis: 40%; }
            .score-display { flex-basis: 20%; margin: 0 5px; }
            .score-box { font-size: 16px; padding: 6px 10px; }
            .score-separator { font-size: 16px; margin: 0 3px; }
        }
    </style>
</head>
<body>

<header>TENNIS CD9 2026</header>

<div class="container">
    <section>
        <div class="section-title">üèÜ B·∫£ng X·∫øp H·∫°ng (BXH)</div>
        <div id="BXH" class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </section>

    <section>
        <div class="section-title">üéæ L·ªãch Thi ƒê·∫•u & K·∫øt Qu·∫£</div>
        <div id="MATCHES" class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </section>

    <section>
        <div class="section-title">ü§ù Danh S√°ch C·∫∑p ƒê·∫•u</div>
        <div id="PAIRS" class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </section>

    <section>
        <div class="section-title">üë• Danh S√°ch Teams</div>
        <div id="TEAMS" class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </section>

    <section>
        <div class="section-title">‚úÖ Ki·ªÉm Tra Theo ƒê·ªôi</div>
        <div class="filter-container">
            <button class="filter-btn active" onclick="filterMatches('ALL', this)">T·∫•t c·∫£</button>
            <button class="filter-btn" onclick="filterMatches('D1', this)">D1</button>
            <button class="filter-btn" onclick="filterMatches('D2', this)">D2</button>
            <button class="filter-btn" onclick="filterMatches('D3', this)">D3</button>
            <button class="filter-btn" onclick="filterMatches('D4', this)">D4</button>
        </div>
        <div id="CHECK_RESULT" class="loading"></div>
    </section>
</div>

<script>
const SHEET_ID = "1pak2Yy4rZ3U50rYj2rlfCOkqyDDpnOns";
let allMatchesData = []; // L∆∞u tr·ªØ d·ªØ li·ªáu g·ªëc MATCHES

async function loadSheet(sheetName, targetId) {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
    
    try {
        const r = await fetch(url);
        const txt = await r.text();
        const json = JSON.parse(txt.substring(47).slice(0, -2));
        const rows = json.table.rows;
        
        if (sheetName === "MATCHES") {
            allMatchesData = rows.filter(row => row.c && row.c.some(cell => cell && cell.v !== null));
            renderMatchesAsCards(allMatchesData, "MATCHES", false); // B·∫£ng MATCHES g·ªëc
            renderMatchesAsCards(allMatchesData, "CHECK_RESULT", true, 'ALL'); // M·∫∑c ƒë·ªãnh b·∫£ng CHECK
        } else {
            renderSimpleTable(json.table, targetId);
        }
    } catch (e) {
        console.error(`L·ªói t·∫£i d·ªØ li·ªáu t·ª´ sheet ${sheetName}:`, e);
        document.getElementById(targetId).innerHTML = `<div class="empty-message">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra l·∫°i Google Sheet.</div>`;
    }
}

// Render c√°c b·∫£ng ƒë∆°n gi·∫£n (BXH, TEAMS, PAIRS) d∆∞·ªõi d·∫°ng b·∫£ng HTML truy·ªÅn th·ªëng
function renderSimpleTable(tableData, targetId) {
    let html = `<div class="table-wrapper"><table><thead><tr>`;
    tableData.cols.forEach(col => html += `<th>${col.label || ""}</th>`);
    html += `</tr></thead><tbody>`;
    tableData.rows.forEach(row => {
        if (!row.c || !row.c.some(c => c && c.v !== null)) return; // B·ªè qua d√≤ng tr·ªëng
        html += `<tr>`;
        row.c.forEach(cell => html += `<td>${cell?.f || cell?.v || ""}</td>`);
        html += `</tr>`;
    });
    document.getElementById(targetId).innerHTML = html + `</tbody></table></div>`;
}

// Render c√°c b·∫£ng MATCHES v√† CHECK d∆∞·ªõi d·∫°ng th·∫ª (Card Layout)
function renderMatchesAsCards(rows, targetId, isCheckMode = false, selectedTeam = 'ALL') {
    if (rows.length === 0) {
        document.getElementById(targetId).innerHTML = `<div class="empty-message">Kh√¥ng t√¨m th·∫•y tr·∫≠n ƒë·∫•u n√†o.</div>`;
        return;
    }

    let cardsHtml = `<div class="card-list">`;
    rows.forEach(row => {
        const date = `${row.c[0]?.v || ''}/${row.c[1]?.v || ''}/${row.c[2]?.v || ''}`;
        const team1Name = String(row.c[3]?.v || "");
        const score1 = parseInt(row.c[4]?.v) || 0;
        const score2 = parseInt(row.c[5]?.v) || 0;
        const team2Name = String(row.c[6]?.v || "");

        let cardClass = "";
        let team1Highlight = "";
        let team2Highlight = "";

        // X√°c ƒë·ªãnh k·∫øt qu·∫£ v√† highlight
        if (isCheckMode && selectedTeam !== 'ALL') {
            const isSelectedTeam1 = team1Name.toUpperCase().includes(selectedTeam.toUpperCase());
            const isSelectedTeam2 = team2Name.toUpperCase().includes(selectedTeam.toUpperCase());

            if (isSelectedTeam1) team1Highlight = "highlight";
            if (isSelectedTeam2) team2Highlight = "highlight";

            if (score1 === 0 && score2 === 0) {
                 cardClass = "pending"; // Tr·∫≠n ch∆∞a ƒë·∫•u
            } else if (score1 === score2) {
                 cardClass = "draw"; // H√≤a
            } else if ((isSelectedTeam1 && score1 > score2) || (isSelectedTeam2 && score2 > score1)) {
                 cardClass = "win"; // Th·∫Øng
            } else {
                 cardClass = "lose"; // Thua
            }
        } else if (score1 === 0 && score2 === 0) {
            cardClass = "pending"; // N·∫øu kh√¥ng ·ªü ch·∫ø ƒë·ªô check, v·∫´n ƒë√°nh d·∫•u pending
        }

        cardsHtml += `
            <div class="match-card ${cardClass}">
                <div class="match-date">${date}</div>
                <div class="team-display">
                    <span class="team-name ${team1Highlight}">${team1Name}</span>
                </div>
                <div class="score-display">
                    <span class="score-box">${score1}</span>
                    <span class="score-separator">-</span>
                    <span class="score-box">${score2}</span>
                </div>
                <div class="team-display">
                    <span class="team-name ${team2Highlight}">${team2Name}</span>
                </div>
            </div>
        `;
    });
    cardsHtml += `</div>`;
    document.getElementById(targetId).innerHTML = cardsHtml;
}

// Logic l·ªçc tr·∫≠n ƒë·∫•u khi b·∫•m n√∫t
function filterMatches(teamCode, btn) {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const filtered = teamCode === 'ALL' ? allMatchesData : allMatchesData.filter(row => 
        String(row.c[3]?.v || "").toUpperCase().includes(teamCode.toUpperCase()) || 
        String(row.c[6]?.v || "").toUpperCase().includes(teamCode.toUpperCase())
    );
    renderMatchesAsCards(filtered, "CHECK_RESULT", true, teamCode);
}

// T·∫£i t·∫•t c·∫£ d·ªØ li·ªáu khi trang ƒë∆∞·ª£c load
window.addEventListener('DOMContentLoaded', () => {
    loadSheet("BXH", "BXH");
    loadSheet("MATCHES", "MATCHES"); // Quan tr·ªçng: MATCHES ph·∫£i load tr∆∞·ªõc ƒë·ªÉ c√≥ d·ªØ li·ªáu cho filter
    loadSheet("PAIRS", "PAIRS");
    loadSheet("TEAMS", "TEAMS");
});
</script>

</body>
</html>
